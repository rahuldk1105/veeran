# render.yaml
#
# This file configures the services for the Veeran Winter Cup application on Render.
# It defines a backend Node.js server and a frontend Next.js web application.

services:
  # -----------------
  #   Backend Service
  # -----------------
  - type: web
    name: veeran-backend
    runtime: node
    plan: free # Or your preferred plan
    rootDir: server
    buildCommand: npm install
    startCommand: npm start
    envVars:
      - key: MONGO_URI
        sync: false # Secret - set in Render dashboard
      - key: SUPABASE_URL
        sync: false # Secret - set in Render dashboard
      - key: SUPABASE_KEY
        sync: false # Secret - set in Render dashboard
      - key: SUPABASE_SERVICE_KEY
        sync: false # Secret - set in Render dashboard
      - key: SUPABASE_JWT_SECRET
        sync: false # Secret - set in Render dashboard
      - key: NODE_ENV
        value: production

  # ------------------
  #   Frontend Service
  # ------------------
  - type: web
    name: veeran-frontend
    runtime: node
    plan: free # Or your preferred plan
    rootDir: client
    buildCommand: npm install && npm run build
    startCommand: npm start
    envVars:
      - key: NEXT_PUBLIC_SUPABASE_URL
        fromService:
          type: web
          name: veeran-backend
          envVarKey: SUPABASE_URL
      - key: NEXT_PUBLIC_SUPABASE_ANON_KEY
        fromService:
          type: web
          name: veeran-backend
          envVarKey: SUPABASE_KEY
      - key: NEXT_PUBLIC_API_URL
        fromService:
          type: web
          name: veeran-backend
          property: url # Automatically use the backend's URL
      - key: NEXT_PUBLIC_WS_URL
        fromService:
          type: web
          name: veeran-backend
          property: url
          # Render uses wss for secure websockets on https
          # We replace http with ws for the WebSocket URL
          modify: "return it.replace(/^http/, 'ws')"
